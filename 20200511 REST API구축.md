

# 20200511 REST API구축

- 모델: 데이터베이스 구조 
- 템플릿: 유저에게 보여주는 데이터 
- 뷰: 데이터조작

----

## API - 개발자용 데이터 표준.약속

APPLICATION PROGRAMMING INTERFACE

개발자가 쓸 수 있는 데이터 약속.

### JSON : 객체식 표기법.!! 짧다. 돈이 덜든다.

![image-20200511095630191](assets/image-20200511095630191.png)

![image-20200511095827315](assets/image-20200511095827315.png)



![image-20200511095913690](assets/image-20200511095913690.png)



```
pip install faker
```

```
board - models.py

from django.db import models
from faker import Faker

f = Faker()
# Create your models here.
class Article(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    @classmethod
    def dummy(cls, n):
        for _ in range(n):
            cls.objects.create(
                title=f.name(),
                content= f.text(),
                )
                
board - urls.py
from django.urls import path
from . import views

app_name = 'board'
urlpatterns = [
    path('json1/',views.article_list_json_1),
    path('json2/',views.article_list_json_2),
    path('json3/',views.article_list_json_3),
]
```

```
board - views.py
from django.shortcuts import render
from django.http.response import JsonResponse
from .models import Article
#Nogada
def article_list_json_1(request):
    articles = Article.objects.all()

    data = []
    for article in articles:
        data.append({
            'article_id': article.id,
            'title': article.title,
            'created_at': article.created_at,
            'updated_at': article.updated_at,
        })

    return JsonResponse(data, safe=False)

```

## DRF - django rest frameword

```bash
pip install djangorestframework
```

```python
settings.py
INSTALLED_APPS = [
    'django_extensions',
    'board',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    #추가하기
    'rest_framework',
]

```

```python
board - serializers.py
from rest_framework import serializers
from .models import Article

class ArticleSerializer(serializers.ModelSerializer):
    class Meta:
        model = Article
        fiels='__all__'
```

```py
board - views.py
from django.shortcuts import render
from django.views.decorators.http import require_GET
from django.http.response import JsonResponse

from rest_framework.response import Response
from rest_framework.decorators import api_views

from .models import Article
from .serializers import ArticleSerializer
#Nogada
@require_GET
def article_list_json_1(request):
    articles = Article.objects.all()

    data = []
    for article in articles:
        data.append({
            'article_id': article.id,
            'title': article.title,
            'created_at': article.created_at,
            'updated_at': article.updated_at,
        })

    return JsonResponse(data, safe=False)

# django core serializer
@require_GET
def article_list_json_2(request):
    from django.core import serializers

    articles = Article.objects.all()
    #데이타를 스트링으로 만들어줌.
    data = serializers.serialize('json', articles)

    # return JsonResponse(data)
    #TMI 정보의 필드를 지정할 수 없다.
    return HttpResponse(data, content_type='application/json')

#json을 쓰는 이유는 효율성을 높이고 !! 절약하기 위해서 한방에!! 필드지정가능.데이터검증
#modelform과 비슷하다.
# rest framework

@api_view(['GET'])
def article_list_json_3(request):
    articles = Article.objects.all()
    #many : 쿼리셋이 여러개일경우 써준다. serializer은 한개가 디폴트.
    serializer = ArticleSerializer(article, many=True)
    
    return Response(serializer.data)



```



```
board - urls.py
from django.urls import path
from . import views

app_name = 'board'
urlpatterns = [
    path('json1/',views.article_list_json_1),
    path('json2/',views.article_list_json_2),
    path('json3/',views.article_list_json_3),
]
```

-----

### DATA만 주자!!

- Django의 기본 serializer가 있지만 쓰지 말자. 복잡하다.
- 쉽고 편하게 drf를 쓰자~

















XML : 1996 W3C에서 발표한 약속. HTML 키값이 반영이 안됨. 길이가 길다.(닫는테그)

![image-20200511095428048](assets/image-20200511095428048.png)